---
- name: Test 'manage_vpc_peering' role
  block:
    - name: Include 'setup.yml' file
      ansible.builtin.include_tasks: setup.yml

    # VPC Peering (same region)
    - name: Test VPC Peering in the same region
      ansible.builtin.include_tasks: vpc_peering.yml
      vars:
        vpc_peering_accepter_vpc_id: "{{ __vpcs_region1.results.0.vpc.id }}"
        vpc_peering_requester_vpc_id: "{{ __vpcs_region1.results.1.vpc.id }}"
        vpc_peering_accepter_region: "{{ test_vpc_region_1.region }}"

    # VPC Peering (different region)
    - name: Test VPC Peering in the same region
      ansible.builtin.include_tasks: vpc_peering.yml
      vars:
        vpc_peering_accepter_vpc_id: "{{ __vpcs_region2.results.0.vpc.id }}"
        vpc_peering_requester_vpc_id: "{{ __vpcs_region1.results.0.vpc.id }}"
        vpc_peering_accepter_region: "{{ test_vpc_region_2.region }}"

  always:
    - name: Include 'teardown.yml' file
      ansible.builtin.include_tasks: teardown.yml
